<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return Asset Management</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background: white;
            padding: 20px;
        }

        h1,
        h2 {
            text-align: center;
            color: #333;
        }

        .form-control {
            border-radius: 10px;
            padding: 10px;
            font-size: 16px;
            width: 40%;
            height: auto;
        }

        .btn {
            border-radius: 30px;
            padding: 10px 30px;
            font-size: 16px;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
            transition: background-color 0.3s ease;
            margin-top: 10px;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            margin-top: 10px;
            color: white;
        }

        .table {
            margin-top: 20px;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 0.5em 1em;
            border-radius: 20px;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: #007bff;
            color: white;
        }

        td {
            text-align: center;
        }

        .toggle-form-btn {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #assetForm {
            display: none;
            background: #f1f1f1;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .wrapper {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: #343a40;
            padding-top: 20px;
            color: white;
            position: fixed;
            height: 100%;
        }

        .sidebar h2 {
            color: white;
        }

        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 15px 10px;
            display: block;
            border-radius: 4px;
            margin: 10px 0;
            transition: background 0.3s ease;
        }

        .sidebar a:hover {
            background-color: #007bff;
        }

        .content {
            margin-left: 250px;
            width: 100%;
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <%- include('partials/sidebar') %>

            <div class="content">
                <div class="toggle-form-btn">
                    <h1>Return Asset Management</h1>
                </div>
                <hr>
                <form id="returnForm">
                    <div class="form-group">
                        <label for="returnEmployeeId">Select Employee:</label>
                        <select id="returnEmployeeId" class="form-control" required></select>
                    </div>
                    <div class="form-group">
                        <label for="returnAssetId">Select Asset:</label>
                        <select id="returnAssetId" class="form-control" required></select>
                    </div>
                    <div class="form-group">
                        <label for="returnReason">Return Reason:</label>
                        <select id="returnReason" class="form-control" required>
                            <option value="upgrade">Upgrade</option>
                            <option value="repair">Repair</option>
                            <option value="resignation">Resignation</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Return Asset</button>
                </form>

            </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- DataTables.net JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            populateEmployeeDropdown();
            populateAssetDropdown();

            $('#returnForm').on('submit', function (e) {
                e.preventDefault();
                const assetId = $('#returnAssetId').val();
                const returnReason = $('#returnReason').val();
                axios.post(`/api/asset-issuance/asset-issuances/return`, { returnDate: new Date(), returnReason, id: assetId })
                    .then(response => {
                        alert('Asset returned successfully!');
                        $('#returnForm')[0].reset();
                    })
                    .catch(error => {
                        console.error('Error returning asset:', error);
                        alert('Error returning asset');
                    });
            });
        });

        function populateEmployeeDropdown() {
            axios.get('/api/employees/') // Adjust the API endpoint to fetch employees
                .then(response => {
                    const employees = response.data;
                    const employeeSelects = $('#employeeId, #returnEmployeeId'); // Select both dropdowns
                    employeeSelects.empty(); // Clear existing options

                    // Add options to the dropdowns
                    employees.forEach(employee => {
                        employeeSelects.append(`<option value="${employee.id}">${employee.name}</option>`);
                    });
                })
                .catch(error => {
                    console.error('Error fetching employees:', error);
                });
        }

        function populateAssetDropdown() {
            axios.get('/api/assets/') // Adjust the API endpoint to fetch assets
                .then(response => {
                    const assets = response.data;
                    const assetSelects = $('#assetId, #returnAssetId'); // Select both dropdowns
                    assetSelects.empty(); // Clear existing options

                    // Add options to the dropdowns
                    assets.forEach(asset => {
                        assetSelects.append(`<option value="${asset.id}">${asset.make}</option>`); // Assuming 'make' is the asset's display name
                    });
                })
                .catch(error => {
                    console.error('Error fetching assets:', error);
                });
        }
    </script>
</body>

</html>